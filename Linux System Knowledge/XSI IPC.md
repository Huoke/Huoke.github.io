# 15.6 XSI IPC
有三种称为 XSI(System Interface and Headers 代表一种Unix系统的标准)IPC 的IPC: 消息队列、信号量和共享存储器。它们之间有很多相似之处。
>提示：
> XSI IPC 函数时紧密地基于System V 的IPC函数。这三种类型的XSI IPC源自1970年的一种称为"Columbus UNIX"的AT&T内部版本。后来被添加到System V上。由于XSI IPC
不使用文件系统命名空间，而是构造了它们自己的命名空间，为此常常受到批评

## 15.6.1 标识符和键
1. IPC标识
   内核为每个进程间通信维护一个结构体形式的IPC对象。该对象可通过一个非负整数的IPC标识来引用。与文件描述符不同，文件描述符总是找当前系统中可用的最小的数，而ipc标识符是持续加1的，它不是去取当前系统中可用的最小数作为标识符的(当一个IPC结构被创建，然后又被删除时，与这种结构相关的标识符是连续加1，直至到达一个整形的最大正值，然后又回转到0)。
2. IPC键值
   IPC标识符是IPC对象的内部名称。若多个进程需要在同一个IPC对象上会合，则必须通过键值作为其外部名称来引用该对象。
   1) 无论何时，只要创建IPC对象，就必须指定一个键值。
   2) 键值的数据类型在sys/types.h头文件中被定义为key_t，其原始类型就是长整型。
3. 客户机进程与服务器进程在IPC对象上的三种会合方式
   1) 服务器进程以IPC_PRIVATE为键值创建一个新的IPC对象，并将该IPC对象的标识存放在某处(如文件中)，以方便客户机进程读取。（内核可以保证它的唯一性）
   2) 在一个公共头文件中，定义一个客户机进程和服务器进程都认可的键值，服务器进程用此键值创建IPC对象， 客户机进程用此键值获取该IPC对象。（自己保证它的唯一性）
   3) 客户机进程和服务器进程， 事先约定好一个路径名和一个项目ID(0-255)，二者通过ftok函数，将该路径名和项目ID转换为一致的键值。（最常使用）
   ```c
   #include <sys/types.h>
   #include <sys/ipc.h>
   key_t ftok (const char* pathname, int proj_id);
   pathname - 一个真实存在的文件或目录的路径名。
   proj_id  - 项目ID，仅低8位有效，其值域为[0,255]。
   ```
   成功返回键值，失败返回-1。
注意：起作用的是pathname参数所表示的路径，而非pathname字符串本身。因此假设当前目录是/home/soft01/uc/day07，则ftok (".", 100);和ftok ("/home/soft01/uc/day07", 100);的返回值完全相同。

4. 3个get函数(msgget、semget和shmget)都是两个类似的参数: 一个key和一个整形flag。
